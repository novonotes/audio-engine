import 'package:dart_style/dart_style.dart';
import 'package:path/path.dart';

String generateIndexDartCode(
  Iterable<String> fileNames, {
  required String extension,
}) {
  final intermediateData = _collectData(fileNames, extension);
  final buffer = StringBuffer();

  void $(String line) {
    buffer.writeln(line);
  }

  $('// *********************************************************');
  $('// DO NOT EDIT THIS FILE.');
  $('// This file is generated by the audio_engine_protoc_plugin.');
  $('// Any changes to this file will be lost.');
  $('//');
  $('// template: index_template.dart');
  $('// *********************************************************');
  $('');

  for (final exportStatement in intermediateData.exportStatements) {
    $(exportStatement);
  }

  return DartFormatter().format(buffer.toString());
}

class _IntermediateData {
  final List<String> exportStatements;

  _IntermediateData({
    required this.exportStatements,
  });
}

_IntermediateData _collectData(Iterable<String> fileNames, String extension) {
  final exportStatements = fileNames
      .map((f) => "export './${basenameWithoutExtension(f)}$extension';")
      .toList();

  return _IntermediateData(
    exportStatements: exportStatements,
  );
}
