# AudioEngineAPI

AudioEngine API は、AudioEngine （以下エンジン）と、エンジン を制御し利用するアプリケーション（以下アプリケーション） の間のインターフェースである。
エンジンとアプリケーションは別プロセスや別デバイスで動作していたり、異なる言語で実装されているため、通信に様々な制約がある。この API の目的は、これらの制約下で、効率的かつ柔軟なエンジンの操作を実現することである。

## プロトコル

通信は Message を双方向に送り合う非同期型の通信である。

エンジンがクライアント、アプリケーションがサーバーと定義する。理由は以下の通りである。

- エンジンがアプリケーションに対して接続要求をするため。
- エンジンがプラグインとしての使用をサポートするため、寿命が他のホストアプリケーションに依存してしまう。このため、ポートを用意して待ち受けする「サーバー」として実装することが技術的に難しい。
- 一つのアプリケーションに対して、複数のエンジンとの接続をサポートする。
- 単一のエンジンインスタンスが複数のアプリケーションに接続するユースケースはサポートしない。

### Message の形式

[NAM](nam-v1.md) に準拠する。
NAP で規定されていない、message body のデータ形式や、context のデータ形式は [APIs のパッケージ](../../APIs/novonotes/audio_engine/README.md) に定義される Protobuf バイナリフォーマットとする。

### メッセージの転送方法

Message の転送方法は以下のように、engine type によって異なる。

- **Audio Engine Library**: Dart FFI
- **Audio Engine Service**: Unix Domain Socket
- **Audio Engine Plugin**: Unix Domain Socket

### リファレンス実装

このレポジトリ内の各パッケージの実装をリファレンス実装とする。
このドキュメントでカバーしきれない、曖昧な部分や詳細な仕様については、これらのリファレンス実装によって具体化する。
